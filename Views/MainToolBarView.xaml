<UserControl x:Class="NX_TOOL_MANAGER.Views.MainToolbarView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:views="clr-namespace:NX_TOOL_MANAGER.Views"
             xmlns:conv="clr-namespace:NX_TOOL_MANAGER.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="72" d:DesignWidth="800">
    <UserControl.Resources>
        <!-- All styles for the toolbar buttons have been moved here from MainWindow -->
        <conv:PageIsSelectedConverter x:Key="PageIsSelectedConverter"/>

        <Style x:Key="ToolBarSeparatorStyle" TargetType="Separator">
            <Setter Property="Background" Value="#4A4A4A"/>
            <Setter Property="Width" Value="1"/>
            <Setter Property="Margin" Value="8,12"/>
        </Style>

        <ControlTemplate x:Key="SquareNavTemplate" TargetType="ContentControl">
            <Border x:Name="border"
            Background="{TemplateBinding Background}"
            BorderBrush="{TemplateBinding BorderBrush}"
            BorderThickness="{TemplateBinding BorderThickness}"
            CornerRadius="6">
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,4">
                    <TextBlock FontFamily="Segoe MDL2 Assets"
                           FontSize="24"
                           HorizontalAlignment="Center"
                           Margin="0,0,0,4"
                           Text="{Binding Tag, RelativeSource={RelativeSource TemplatedParent}}"
                           Foreground="{TemplateBinding Foreground}"/>
                    <ContentPresenter Content="{TemplateBinding Content}"
                                  HorizontalAlignment="Center"
                                  TextBlock.Foreground="{TemplateBinding Foreground}"/>
                </StackPanel>
            </Border>
        </ControlTemplate>

        <Style x:Key="SquareNavButton" TargetType="Button">
            <Setter Property="Width" Value="64"/>
            <Setter Property="Height" Value="64"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Background" Value="#333333"/>
            <Setter Property="BorderBrush" Value="#4A4A4A"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <ContentControl Template="{StaticResource SquareNavTemplate}"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Foreground="{TemplateBinding Foreground}"
                                Content="{TemplateBinding Content}"
                                Tag="{TemplateBinding Tag}"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#454545"/>
                    <Setter Property="BorderBrush" Value="#6A6A6A"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#2A2A2A"/>
                    <Setter Property="BorderBrush" Value="#6A6A6A"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="#2D2D2D"/>
                    <Setter Property="Foreground" Value="#666666"/>
                    <Setter Property="BorderBrush" Value="#4A4A4A"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="SquareNavToggleButton" TargetType="ToggleButton">
            <Setter Property="Width" Value="64"/>
            <Setter Property="Height" Value="64"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Background" Value="#333333"/>
            <Setter Property="BorderBrush" Value="#4A4A4A"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="border"
                        Background="{TemplateBinding Background}"
                        BorderBrush="{TemplateBinding BorderBrush}"
                        BorderThickness="{TemplateBinding BorderThickness}"
                        CornerRadius="6">
                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,4">
                                <TextBlock FontFamily="Segoe MDL2 Assets"
                                   FontSize="24"
                                   HorizontalAlignment="Center"
                                   Margin="0,0,0,4"
                                   Text="{Binding Tag, RelativeSource={RelativeSource TemplatedParent}}"
                                   Foreground="{TemplateBinding Foreground}"/>
                                <ContentPresenter Content="{TemplateBinding Content}"
                                          HorizontalAlignment="Center"
                                          TextBlock.Foreground="{TemplateBinding Foreground}"/>
                            </StackPanel>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#454545"/>
                    <Setter Property="BorderBrush" Value="#6A6A6A"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#2A2A2A"/>
                    <Setter Property="BorderBrush" Value="#6A6A6A"/>
                </Trigger>
                <Trigger Property="IsChecked" Value="True">
                    <Setter Property="Foreground" Value="#3399FF"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- THE FIX: This new style provides a custom, simple template for the ToolBar -->
        <Style TargetType="{x:Type ToolBar}">
            <Setter Property="SnapsToDevicePixels" Value="true" />
            <Setter Property="Padding" Value="4"/>
            <Setter Property="Height" Value="72"/>
            <Setter Property="Background" Value="#2D2D2D"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ToolBar}">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="#4A4A4A"
                                BorderThickness="0,0,0,1">
                            <!-- This panel is where the buttons are hosted. It doesn't have a gripper. -->
                            <ToolBarPanel x:Name="PART_ToolBarPanel" IsItemsHost="true" Margin="0" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <ToolBar>
        <Button Style="{StaticResource SquareNavButton}" Margin="10,0,8,0" Content="Library" Tag="&#xE8E5;" Click="LoadLibrary_Click"/>
        <Button Style="{StaticResource SquareNavButton}" Content="Save" Tag="&#xE74E;" IsEnabled="{Binding IsSaveEnabled}" Click="SaveLibrary_Click"/>
        <Separator Style="{StaticResource ToolBarSeparatorStyle}"/>

        <!-- Navigation Buttons -->
        <ToggleButton Style="{StaticResource SquareNavToggleButton}"
                      Content="Viewer" Tag="&#xE8A3;"
                      IsChecked="{Binding CurrentPage, Converter={StaticResource PageIsSelectedConverter}, ConverterParameter={x:Static views:PageKind.Viewer}}"
                      Click="Viewer_Click"/>
        <ToggleButton Style="{StaticResource SquareNavToggleButton}"
                      Content="Bulk Editor" Tag="&#xE70F;"
                      IsChecked="{Binding CurrentPage, Converter={StaticResource PageIsSelectedConverter}, ConverterParameter={x:Static views:PageKind.BulkEditor}}"
                      Click="BulkEditor_Click"/>
        <ToggleButton Style="{StaticResource SquareNavToggleButton}"
                      Content="Merger" Tag="&#xE8AB;"
                      IsChecked="{Binding CurrentPage, Converter={StaticResource PageIsSelectedConverter}, ConverterParameter={x:Static views:PageKind.Merger}}"
                      Click="Merger_Click"/>

        <Separator Style="{StaticResource ToolBarSeparatorStyle}"/>
        <Button Style="{StaticResource SquareNavButton}" Content="Convert" Tag="&#xE72D;" Click="Convert_Click"/>
        <Button Style="{StaticResource SquareNavButton}" Content="Import"  Tag="&#xE774;" Click="Import_Click"/>
        <Button Style="{StaticResource SquareNavButton}" Content="Export"  Tag="&#xE778;" Click="Export_Click"/>
    </ToolBar>
</UserControl>

